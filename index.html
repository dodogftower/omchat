<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Chat Simulation (Ometv Style)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Dark background */
        }
        /* Custom video styling for better aesthetics */
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #161b22; /* Dark placeholder color */
        }
        .video-box {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            aspect-ratio: 16 / 9; /* Standard video aspect ratio */
            min-height: 200px; /* Ensure visibility on small screens */
        }
        /* Custom modal styles for touch-friendly notifications */
        #messageBox {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col items-center">

    <div class="w-full max-w-5xl mx-auto">
        <h1 class="text-3xl md:text-4xl font-extrabold text-white text-center mb-8">
            <span class="text-red-500">Om</span>Chat Simulator
        </h1>

        <!-- Main Video Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Local User Video -->
            <div class="video-box border-4 border-gray-700">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="absolute bottom-3 left-3 px-3 py-1 bg-gray-900 bg-opacity-70 rounded-full text-xs font-semibold text-white">
                    You (Local Stream)
                </div>
            </div>

            <!-- Remote Partner Video -->
            <div class="video-box border-4 border-red-500">
                <video id="remoteVideo" playsinline></video>
                <div id="remotePlaceholder" class="absolute inset-0 flex items-center justify-center p-8 text-center text-gray-400 text-sm md:text-lg bg-[#161b22]">
                    Waiting for a connection...
                </div>
                <div class="absolute bottom-3 left-3 px-3 py-1 bg-red-600 bg-opacity-70 rounded-full text-xs font-semibold text-white">
                    Partner
                </div>
            </div>
        </div>

        <!-- Status & Controls -->
        <div class="p-6 bg-[#161b22] rounded-xl shadow-lg border border-gray-700">
            <div id="status" class="text-center text-lg font-bold mb-4 text-yellow-400">
                Status: Ready to Connect
            </div>

            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6">
                <button id="connectBtn" 
                        class="flex-1 px-8 py-4 bg-green-600 text-white font-extrabold rounded-xl text-lg hover:bg-green-700 transition duration-150 shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
                        onclick="simulateConnection()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M14 10h4.764m-4.764 0l-1.39 4.305m1.39-4.305h-4.764M14 10v4.764m-4.764 0H5.236m4.764 0l1.39-4.305m-1.39 4.305v-4.764" />
                    </svg>
                    CONNECT (Find Stranger)
                </button>

                <button id="nextBtn" 
                        class="flex-1 px-8 py-4 bg-red-600 text-white font-extrabold rounded-xl text-lg hover:bg-red-700 transition duration-150 shadow-md disabled:opacity-50 disabled:cursor-not-allowed"
                        onclick="simulateNext()" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                    </svg>
                    NEXT (Skip)
                </button>
            </div>
            
            <p class="text-xs text-gray-500 mt-6 text-center">
                *Note: This simulation shows your local stream and status changes. Real peer-to-peer connection requires a backend signaling server (WebSockets, STUN/TURN) which cannot be included in this single file.
            </p>
        </div>
    </div>

    <!-- Custom Message Box (Replaces alert()) -->
    <div id="messageBox" class="fixed bottom-8 p-4 rounded-xl shadow-2xl z-50 w-11/12 max-w-md text-white font-semibold hidden opacity-0">
    </div>

    <script>
        const localVideo = document.getElementById('localVideo');
        const remoteVideo = document.getElementById('remoteVideo');
        const remotePlaceholder = document.getElementById('remotePlaceholder');
        const statusDisplay = document.getElementById('status');
        const connectBtn = document.getElementById('connectBtn');
        const nextBtn = document.getElementById('nextBtn');
        const messageBox = document.getElementById('messageBox');

        let localStream = null;
        let connectionState = 'ready'; // ready, connecting, connected

        // --- Custom Message Box Utility ---

        /** Shows a temporary, non-blocking message */
        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.className = `fixed bottom-8 p-4 rounded-xl shadow-2xl z-50 w-11/12 max-w-md text-white font-semibold transition-all duration-300 transform ${isError ? 'bg-red-600' : 'bg-blue-600'} visible opacity-100 translate-y-0`;
            
            // Center horizontally
            messageBox.style.left = '50%';
            messageBox.style.transform = 'translateX(-50%)';

            clearTimeout(messageBox.timer);
            messageBox.timer = setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0', 'hidden');
            }, 4000);
            messageBox.classList.remove('hidden');
        }


        // --- Core WebRTC Simulation Functions ---

        /** 1. Gets the local video/audio stream */
        async function startLocalStream() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                localVideo.srcObject = localStream;
                showMessage("Camera access successful. Ready to connect!");
                // Enable connect button if stream is ready
                connectBtn.disabled = false;
                statusDisplay.textContent = "Status: Ready to Connect";
                statusDisplay.className = "text-center text-lg font-bold mb-4 text-green-400";
            } catch (err) {
                console.error("Error accessing media devices: ", err);
                statusDisplay.textContent = "Error: Camera/Mic Access Denied. Please enable media access.";
                statusDisplay.className = "text-center text-lg font-bold mb-4 text-red-500";
                connectBtn.disabled = true;
                showMessage("FATAL ERROR: Could not access camera/mic. Check permissions.", true);
            }
        }

        /** 2. Simulates the connection process */
        function simulateConnection() {
            if (connectionState === 'connected') {
                showMessage("You are already connected. Use NEXT to skip.");
                return;
            }

            connectionState = 'connecting';
            connectBtn.disabled = true;
            nextBtn.disabled = true;

            statusDisplay.textContent = "Status: Searching for a partner...";
            statusDisplay.className = "text-center text-lg font-bold mb-4 text-yellow-400";
            remotePlaceholder.innerHTML = 'Searching... <div class="mt-4 border-4 border-gray-700 border-t-red-500 rounded-full w-8 h-8 animate-spin mx-auto"></div>';

            // Simulate signaling delay (2 seconds)
            setTimeout(() => {
                // In a real app, this is where the WebRTC connection would be established.
                // We simulate success.
                connectionState = 'connected';
                connectBtn.disabled = true;
                nextBtn.disabled = false;
                
                statusDisplay.textContent = "Status: Connected! Say Hi!";
                statusDisplay.className = "text-center text-lg font-bold mb-4 text-green-400";
                
                // Simulate remote video by removing the placeholder
                remotePlaceholder.classList.add('hidden');
                remoteVideo.style.backgroundColor = 'transparent'; // Show actual video color

                showMessage("Match found! You are now chatting with a stranger.", false);

            }, 2000);
        }

        /** 3. Simulates disconnecting and searching for the next user */
        function simulateNext() {
            // 1. Disconnect the current partner (simulated)
            connectionState = 'ready';
            
            // Reset remote video state
            remoteVideo.srcObject = null;
            remotePlaceholder.classList.remove('hidden');
            remotePlaceholder.textContent = 'Connection ended. Finding the next person...';

            showMessage("Skipped partner. Finding new match...", false);
            
            // 2. Immediately start searching for a new connection
            simulateConnection();
        }

        /** Initialize the application on page load */
        document.addEventListener('DOMContentLoaded', startLocalStream);
    </script>
</body>
</html>